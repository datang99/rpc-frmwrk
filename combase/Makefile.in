include ../Makefile.init.pub

TARGET:=libcombase.so
SOURCES:= clsids.cpp autoptr.cpp buffer.cpp \
	config.cpp objbase.cpp \
	registry.cpp \
	creatins.cpp \
	serial.cpp \
	dbuserr.cpp \
	objfctry.cpp \
	dmsgptr.cpp \
    seribase.cpp \

OBJS:=$(SOURCES:%.cpp=$(OBJ_DIR)/%.o)

all: $(OUTPUT_DIR)/$(TARGET)
debug: $(OUTPUT_DIR)/$(TARGET)
release: $(OUTPUT_DIR)/$(TARGET)

$(OUTPUT_DIR)/$(TARGET) : $(OBJS)
	@if [ ! -d $(OUTPUT_DIR) ]; then mkdir -p $(OUTPUT_DIR);fi
	$(CC) -o $(OUTPUT_DIR)/$(TARGET) -shared $(LINKER_OPTION) -ldbus-1 -llz4 $(OBJS)

-include $(OBJS:%.o=%.d)

debug_clean: do_clean
release_clean: do_clean

clean:
	make debug_clean
	make release_clean

do_clean:
	-@rm $(OBJ_DIR)/*.d $(MUTE_CLEAN)
	-@rm $(OUTPUT_DIR)/$(TARGET) $(MUTE_CLEAN)
	-@rm $(OBJS) $(MUTE_CLEAN)

.PHONY: sync
