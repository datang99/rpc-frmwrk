include ../Makefile.init.pub

TARGET:=libipc.so
SOURCES:= \
stream.cpp portex.cpp iftasks.cpp ifstat.cpp \
rpcif.cpp gmloop.cpp sevpoll.cpp counters.cpp \
connmgr.cpp filetran.cpp mainloop.cpp dllexp.cpp \
evloop.cpp dbushook.cpp irp.cpp irpthread.cpp \
port.cpp portstat.cpp drvmgr.cpp utils.cpp \
iomgr.cpp ptifmap.cpp pnpmgr.cpp dbusdrv.cpp \
dbusport.cpp portdrv.cpp rpcpdo.cpp dbuspdo.cpp \
tasklets.cpp lpbkmtch.cpp ifhelper.cpp iiddict.cpp \
reqopen.cpp


# uncomment the line if _USE_LIB_EV is not defined
#LINKER_OPTION += -lglib-2.0 -ldbus-glib-1

OBJS := $(SOURCES:%.cpp=$(OBJ_DIR)/%.o)
C_DEFINES += -D_USE_LIBEV=1

all: $(OUTPUT_DIR)/$(TARGET)
debug: $(OUTPUT_DIR)/$(TARGET)
release: $(OUTPUT_DIR)/$(TARGET)

$(OUTPUT_DIR)/$(TARGET) : $(OBJS)
	@if [ ! -d $(OUTPUT_DIR) ]; then mkdir -p $(OUTPUT_DIR);fi
	$(CC) -o $(OUTPUT_DIR)/$(TARGET) $(LINKER_OPTION) $(OBJS)

-include $(OBJS:%.o=%.d)

debug_clean: do_clean
release_clean: do_clean

clean:
	make debug_clean
	make release_clean

do_clean:
	-@rm $(OBJ_DIR)/*.d $(MUTE_CLEAN)
	-@rm $(OUTPUT_DIR)/$(TARGET) $(MUTE_CLEAN)
	-@rm $(OBJS) $(MUTE_CLEAN)

.PHONY: sync
