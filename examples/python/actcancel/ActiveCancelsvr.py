#Generated by RIDLC, make sure to backup before running RIDLC again
from typing import Tuple
from rpcf.rpcbase import *
from rpcf.proxy import *
from seribase import CSerialBase
from actcancelstructs import *
import numpy
import errno

from ActiveCancelsvrbase import *
class CIActiveCancelsvr( IIActiveCancel_SvrImpl ):

    def LongWaitCb( self, oReqCtx : PyReqContext ) :
        #timer callback, complete the request
        context = oReqCtx.oContext; 
        strText = context[ 1 ]
        context[ 0 ] = None
        self.OnLongWaitComplete(
            oReqCtx, 0, strText );
        print( "LongWait request completed " )
        return

    '''
    Asynchronous request handler
    '''
    def LongWait( self, oReqCtx : PyReqContext,
        i0 : str
        ) -> Tuple[ int, list ] :
        '''
        the response parameters includes
        i0r : str
        '''
        #Implement this method here

        #schedule a timer to complete this request
        #in 30 seconds

        print( "i0 is " + str(i0))

        ret = self.AddTimer( 30,
            CIActiveCancelsvr.LongWaitCb,
            oReqCtx )
            
        if ret[ 0 ] < 0 :
            return [ ret[ 0 ],  ]

        timerObj = ret[ 1 ]
        oReqCtx.oContext = [ timerObj, i0 ] 
        #return pending
        return [ 65537, ]
        
    '''
    This method is called when the async
    request is cancelled due to timeout
    or user request. Add your own cleanup
    code here
    '''
    def OnLongWaitCanceled( self,
        oReqCtx : PyReqContext, iRet : int,
        i0 : str ):
        #disable the timer we scheduled
        if oReqCtx.oContext is not None:
            timerObj = oReqCtx.oContext[ 0 ]
            self.DisableTimer( timerObj )
            oReqCtx.oContext[ 0 ] = None
            print( "LongWait request canceled with " + oReqCtx.oContext[1] )

        
    
class CActiveCancelServer(
    CIActiveCancelsvr,
    PyRpcServer ) :
    def __init__( self, pIoMgr, strDesc, strObjName ) :
        PyRpcServer.__init__( self,
            pIoMgr, strDesc, strObjName )
