#Generated by RIDLC, make sure to backup before running RIDLC again
from typing import Tuple
from rpcf.rpcbase import *
from rpcf.proxy import *
from seribase import CSerialBase
from asynctststructs import *
import errno

from AsyncTestcli import CAsyncTestProxy
import os
import time


def maincli() :
    ret = 0
    oContext = PyRpcContext( 'PyRpcProxy' )
    with oContext :
        print( "start to work here..." )
        strPath_ = os.path.dirname( os.path.realpath( __file__ ) )
        strPath_ += '/asynctstdesc.json'
        oProxy = CAsyncTestProxy( oContext.pIoMgr,
            strPath_, 'AsyncTest' )
        ret = oProxy.GetError()
        if ret < 0 :
            return ret
        
        with oProxy :
            state = oProxy.oInst.GetState()
            while state == cpp.stateRecovery :
                time.sleep( 1 )
                state = oProxy.oInst.GetState()
            if state != cpp.stateConnected :
                return ErrorCode.ERROR_STATE

            while True:
                i0 = "hello, LongWait"
                pret = oProxy.LongWait( i0 )
                if pret[ 0 ] < 0 :
                    ret = pret[ 0 ]
                    print( "LongWait failed with error " + str(ret) )
                    break
                print( "LongWait completed with response " +
                    pret[ 1 ][ 0 ] )
                    
                pret = oProxy.LongWaitNoParam( "no context" )
                if pret[ 0 ] < 0:    
                    ret = pret[ 0 ]
                    print( "LongWaitNoParam failed with error " +
                        str(ret) )
                    break

                if pret[ 0 ] == 65537 :
                    oProxy.WaitForComplete()
                    ret = oProxy.GetError()
                    if ret == 0 :
                        print( "LongWaitNoParam completed" )
                    else :
                        print( "LongWaitNoParam failed with error " +
                            str(ret) )
                else :
                    print( "LongWaitNoParam complete with " +
                        pret[ 1 ][ 0 ] )
                        
                i0 = "hello, LongWait2"
                pret = oProxy.LongWait2( i0 )    
                if pret[ 0 ] < 0 :
                    ret = pret[ 0 ]
                    print( "LongWait2 failed with error " + str(ret) )
                    break
                print( "LongWait2 completed with response " +
                    pret[ 1 ][ 0 ] )
                ret = 0
                break
        oProxy = None
    oContext = None
    return ret
    
ret = maincli()
quit( -ret )
